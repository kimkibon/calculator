<!DOCTYPE html>
<html lang="ko" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout}"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<!-- index.html 고유 CSS 추가 -->
<th:block layout:fragment="css">
  <!--    <link rel="stylesheet" th:href="@{/css/page/home.css}" >-->
</th:block>
<!-- index.html 고유 스크립트 추가 -->
<th:block layout:fragment="script">
  <script th:inline="javascript">
    const skillEffects = /*[[${skillEffects.skillEffectDto}]]*/;
    let idNum = skillEffects.length - 1;

    const defaultClass = 'form-control';

    function addItemInput() {
      const oldNode = document.getElementById('mainClass' + idNum);
      idNum++;
      const newNode = oldNode.cloneNode(true);
      newNode.id = 'mainClass' + idNum;

      newNode.childNodes[1].childNodes[1].id = 'skillEffectDto' + idNum + '.effectsName';
      newNode.childNodes[1].childNodes[1].name = 'skillEffectDto[' + idNum + '].effectsName';
      newNode.childNodes[1].childNodes[1].value = '';

      newNode.childNodes[3].childNodes[1].id = 'skillEffectDto' + idNum + '.effects';
      newNode.childNodes[3].childNodes[1].name = 'skillEffectDto[' + idNum + '].effects';
      newNode.childNodes[3].childNodes[1].value = '';
      oldNode.after(newNode);
    }

    function deleteItemInput() {
      if (idNum < 1) {
        alert('아이템이 너무 적습니다.')
      } else {
        const lastNode = document.getElementById('mainClass' + idNum);
        lastNode.remove()
        idNum = idNum - 1;
      }
    }

  </script>
</th:block>

<!-- Content -->
<div layout:fragment="content">
  <h1>test</h1>
  <h1>test</h1>
  <form th:object="${skillEffects}" method="post">

    <div class="row m-1" th:each="skillEffects , index : ${skillEffects.skillEffectDto}" th:id="mainClass__${index.index}__">
      <div class="row">
        <input class="form-control" th:field="*{skillEffectDto[__${index.index}__].effectsName}">
      </div>
      <div class="row">
        <textarea class="form-control" th:field="*{skillEffectDto[__${index.index}__].effects}"></textarea>
      </div>
      <div><br/></div>
    </div>
    <div class="row m-1">
      <div class="d-flex justify-content-end">
        <button class="btn btn-danger" type="button" onclick="deleteItemInput()">아이템 삭제</button>
        <button class="btn btn-warning" type="button" onclick="addItemInput()">아이템 추가</button>
        <button class="btn btn-primary" type="submit">입력</button>
      </div>
    </div>
  </form>
</div>

</html>